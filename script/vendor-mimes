#!/usr/bin/env ruby
# Frozen-String-Literal: true
# Vendors the MIME type config from the mime-db list
# Usage: script/vendor-mimes
# Encoding: UTF-8

require "open-uri"
require "bundler/setup"
require "json"
require "pry"

config = File.expand_path "../lib/jekyll/mime.types", __dir__
json = open('https://raw.githubusercontent.com/jshttp/mime-db/master/db.json').read
data = JSON.parse(json).keep_if { |key, val| val.key?("extensions") }
adjustment = data.keys.max_by(&:length).length + 4

out = data.each_with_object([]) do |(type, meta), array|
  type = type.downcase.ljust(adjustment)
  meta = meta["extensions"].map { |val| ".#{val.downcase}" }
  array << (type << meta.join("\s"))
end

out.unshift "# This file is generated automatically by script/vendor-mimes." \
"\n# You should use script/vendor-mimes to update it.\n"
File.write(config, out.join("\n"))
